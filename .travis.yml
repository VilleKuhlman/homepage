language: node_js
node_js:
  - "14.17.0"

before_install:
  - npm i -g npm@latest

addons:
  chrome: stable

cache:
  npm: false

install:
  - npm install --loglevel=error --legacy-peer-deps
stages:
  - test
  - deploy

jobs:
  include:
    - stage: test               
      name: "Unit Tests"            
      script: npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI
    - stage: deploy
      name: "Deploy to Firebase"
      script: npm run build
      deploy:
        provider: firebase
        token:
          secure: "1//0cFD0EY7XnV0RCgYIARAAGAwSNwF-L9IrRfoApyMoUwz2oaN7O9dRJH9iaQozQ8D1FH8MR4OFmEpnhYVmHp52BvGMqU84Op8Dcfw"
        project: "vk-homepage-367f8"
        message: "App 0.88"
        on:
          branch: main
        skip_cleanup: true
